# wasm-workshop

Мастер-класс для конференции ДАМП 2017 (Екатеринбург)

Автор: Валерий Кузьмин, СКБ Контур

### Немного о мастер-классе

На этом мастер классе вы сможете сами написать на JS простую 2d-игру с использованием C++ библиотеки Box2D и отображением на canvas. Вы научитесь подключать wasm модули на страницу, моделировать физику при помощи Box2D, работать c paper.js для отрисовки простых фигур на canvas, и управлять памятью в emscripten. Будет возможность решать задачи на своем ноутбуке или просто смотреть на лайв-кодинг. Формат: 15 минут теории + 75 минут практики.

Мастер-класс можно выполнять самостоятельно, без ведущего, но для этого рекомендую ознакомиться с презентацией (ссылка будет доступна после выступления)

Конечно, целиком и полностью написать игру за 1.5 часа будет тяжело. Поэтому я сделал большую часть грязной работы в репозитории, за вас - в заданиях останется лишь делать самое интересное и учиться ключевым моментам.

### Задания

##### (1) Подключаем emscripten-модуль

Результат комплияции C++ кода в emscripten - это не только wasm файл, но еще js-обертка к нему. Подключить его к обычному проекту, например засунув в webpack - не самая тривиальная задача.

1. Замените глобальный скрипт на загрузку через webpack
1. Попробуйте закомментировать странный код в initBox2d
1. Исправьте start.js/serverConfig, добавив в before правильный mime-тип у файлов *.wasm
1. Добавьте в App/componentDidMount this.start()

##### (2) Создаем статические объекты

1. Реализуйте Game/makeRectangleBody
1. Реализуйте Game/initializeMap

##### (3) Создаем динамические объекты

1. Добавьте bodyDefinition.set_type(Box2D.b2_dynamicBody) в makeRectangleImpl
1. Исправьте Boulder/constructor, воспользовавшись новым флагом

##### (4) Рисуем спрайты на paper.js

1. Расчитайте правильные координаты в методе Graphics/getRasterAbsolutePosition
1. Замените логику отрисовки в Graphics/getImageFromSprite с простых квадратиков на спрайт + вырезающий из него контур

##### (5) Делаем игровую логику

1. В методе boulder/tryBreak добавьте создание нескольких объектов rock
1. TODO: В методе player/tryShoot сделайте создание объектов типа pickaxe
